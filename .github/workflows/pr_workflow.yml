name: PR Workflow

on:
  pull_request:
    branches:
      - 'develop' # master

jobs:
  # checkRef:
  #   runs-on: ubuntu-latest
  #   outputs:
  #     is_rc: ${{ steps.check_ref.outputs.ref_contains_rc }}
    
  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Check if "rc" is present in github.ref
  #       id: check_ref
  #       run: |
  #         echo ${{ github.head_ref || github.ref_name }}
  #         if [[ "${{ github.head_ref || github.ref_name }}" == *"/rc/"* ]]; then
  #           echo "ref_contains_rc=1" >> $GITHUB_OUTPUT
  #         else
  #           echo "ref_contains_rc=0" >> $GITHUB_OUTPUT
  #         fi
      
  #     - name: Output check result
  #       run: |
  #         echo "Output: ${{ steps.check_ref.outputs.ref_contains_rc }}"

  make-or-update-pr:
    runs-on: ubuntu-latest
    # needs: checkRef
    # if: needs.checkRef.outputs.is_rc == 1

    steps:
      - name: Find Comment
        uses: peter-evans/find-comment@v2
        id: fc
        with:
          issue-number: ${{ github.event.pull_request.number }}
          body-includes: Release notes

      - name: Create comment link
        id: create_link
        run: |
          echo "::set-output name=comment_link::https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number }}#issuecomment-${{ steps.fc.outputs.comment-id }}"

      - name: Extract version from branch name
        id: extract_version
        run: |
          echo "::set-output name=version::${GITHUB_REF#refs/heads/rc/}"

      - name: Create new branch and file in nova-wallet-android-releases repo
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: novasamatech/nova-wallet-android-releases
          event-type: create-pr
          client-payload: '{"version": "${{ steps.extract_version.outputs.version }}", "comment_link": "${{ steps.create_link.outputs.comment_link }}", "time": "2023-10-27T12:00:00Z", "severity": "Major"}'
